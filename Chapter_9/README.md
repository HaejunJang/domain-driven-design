# 9장도메인 모델과 바운디드 컨텍스트

### 도메인 모델과 바운디드 컨텍스트

> 처음 도메인 모델을 만들 때 도메인을 완벽하게 표현하는 단일 모델을 만드는 시도를 하는 것이다. 하지만 한개의 모델로 여러 하위 도메인을 모두 표현하려고 시도하면 오히려 모든 하위 도메인에 맞지 않는 모델을 만들게 된다.

- ex) 카탈로그에서는 물리적으로 한 개인 상품이 재고 관리에서는 여러개 존재
- ex) 회원 도메인에서는 회원이라 부르지만, 주문 도메인에서는 주문자, 배송 도메인에서는 보내는 사람이라 부른다.

따라서 한개의 모델로 모든 하위 도메인을 표현하려는 시도는 올바른 방법이 아니며 표현할 수도 없다.

이를 해결하기 위해서는 하위 도메인마다 모델을 만들어야 한다.

모델은 특정한 컨텍스트(문맥) 하에서 완전한 의미를 갖는다 이렇게 경계를 갖는 컨텍스트를 DDD에서는 **바운디드 컨텍스트**라고 부른다

### 바운디드 컨텍스트

- 모델의 경계를 결정하며 논리적으로 한개의 모델을 갖는다.
- 바운디드 컨텍스트는 용어를 기준으로 구분한다.
- 한 개의 바운디드 컨텍스트가 여러 하위 도메인을 포함하더라도 하위 도메인마다 구분되는 패키지를 갖도록 구현해야 한다.
- 바운디드 컨텍스트는 도메인 기능을 사용자에게 제공하는데 필요한 표현영역, 응용서비스, 인프라스트,도메인 영역을 모두 포함한다.

### 바운디드 컨텍스트 간 통합

왜 바운디드 컨텍스트 간 통합이 필요한가?

- 바운디드 컨텍스트는 모델을 분리하기 위한 개념이지만 실제 비즈니스 흐름에서는 컨텍스트 간 의미 전달이 필요하다.
- 한 컨텍스트에서 발생한 상태 변화가 다른 컨텍스트의 의사결정에 영향을 주는 경우 통합이 필요하다.

### 통신 방식 : REST API를 이용한 직접 통합

- 다른 바운디드 컨텍스트의 API를 직접 호출
- 즉각적인 응답이 필요한 경우에 사용
- 동기처리, 강한 결합, 장애 전파 가능성 존재

사용 예

- 주문 생성 시 회원 상태 조회
- 인증/인가 확인

### 통신 방식 : 도메인에 맞는 모델로 변환 (ACL 개념)

- 다른 컨텍스트의 모델을 그대로 사용하지 않고 변환
- Anti-Corruption Layer(ACL)를 통해 모델 오염 방지
- 통신 방식이 아니라 설계 전략
- DTO, Adapter 계층을 통해 변환
- 컨텍스트 간 독립성 유지

### 통신 방식 : 메시지 큐를 사용한 통합(비동기)

- 이벤트 기반 통신
- 한 컨텍스트에서 이벤트 발행 → 다른 컨텍스트에서 수신
- 느슨한 결합, 확장성 좋음

사용 예

- 회원 탈퇴 이벤트 → 주문 정책 정리
- 결제 완료 이벤트 → 주문 상태 변경

### 마이크로서비스와 바운디드 컨텍스트

- 마이크로서비스는 애플리케이션을 독립된 서비스 단위로 분리하는 아키텍처 스타일
- 바운디드 컨텍스트를 마이크로서비스로 구현하면
  - 컨텍스트별로 프로젝트 분리
  - 모델 혼합 방지
  - 자연스러운 컨텍스트 분리 가능
- 마이크로서비스는 바운디드 컨텍스트를 물리적으로 분리한 구현 방식 중 하나

### 바운디드 컨텍스트 간 관계

1. REST API / 단일 API 방식

- 동기 통합
- 강한 의존성
- 즉각적인 응답이 필요한 경우 사용

1. 독립 방식

- 서로 통합하지 않고 독립적으로 발전
- 초기에는 단순하지만 규모가 커질수록 한계 발생
- 결국 통합이 필요해직 가능성 높음

### 컨텍스트 맵

- 개별 바운디드 컨텍스트에 매몰되면 전체 구조를 보기 어렵다.
- 컨텍스트 간 관계를 한눈에 보기 위한 지도 역할

### 컨텍스트 맵 역할

- 컨텍스트 간 의존성 시각화
- 통신 방식(REST, 이벤트 등) 정리
- 팀 간 설계 합의 및 문서화
- 향후 마이크로서비스 전환 시 기준점 제공
